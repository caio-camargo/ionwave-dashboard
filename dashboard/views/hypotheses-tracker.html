<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hypotheses Tracker - IonWave</title>
  <link rel="stylesheet" href="../css/styles.css">
  <style>
    .hypotheses-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
      gap: var(--gap-lg);
      margin-top: var(--gap-lg);
    }

    .hypothesis-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      padding: var(--gap-lg);
      position: relative;
    }

    .hypothesis-card.critical { border-left: 3px solid var(--color-critical); }
    .hypothesis-card.high { border-left: 3px solid var(--color-warning); }
    .hypothesis-card.medium { border-left: 3px solid #ffc107; }
    .hypothesis-card.low { border-left: 3px solid var(--color-success); }

    .hyp-header {
      display: flex;
      justify-content: space-between;
      align-items: start;
      margin-bottom: var(--gap-md);
    }

    .hyp-id {
      font-family: var(--font-mono);
      font-size: var(--font-size-xs);
      color: var(--text-dim);
      font-weight: 600;
    }

    .hyp-name {
      font-size: var(--font-size-lg);
      font-weight: 600;
      color: var(--text-primary);
      margin: 4px 0 8px 0;
    }

    .grade-badge {
      font-size: 1.5rem;
      font-weight: 700;
      width: 48px;
      height: 48px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-left: var(--gap-md);
      flex-shrink: 0;
    }

    .grade-a { background: var(--color-success-bg); color: var(--color-success); border: 1px solid var(--color-success); }
    .grade-b { background: var(--color-info-bg); color: var(--color-info); border: 1px solid var(--color-info); }
    .grade-c { background: var(--color-warning-bg); color: var(--color-warning); border: 1px solid var(--color-warning); }
    .grade-d { background: var(--color-critical-bg); color: var(--color-critical); border: 1px solid var(--color-critical); }

    .hyp-badges {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: var(--gap-md);
    }

    .hyp-description {
      color: var(--text-secondary);
      line-height: 1.6;
      margin-bottom: var(--gap-md);
      font-size: var(--font-size-sm);
    }

    .hyp-details {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: var(--gap-md);
      margin-top: var(--gap-md);
      padding-top: var(--gap-md);
      border-top: 1px solid var(--border-color);
      font-size: var(--font-size-sm);
    }

    .detail-item {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .detail-label {
      color: var(--text-dim);
      font-size: var(--font-size-xs);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .detail-value {
      color: var(--text-primary);
      font-weight: 500;
    }

    .risk-box {
      margin-top: var(--gap-md);
      padding: var(--gap-md);
      background: rgba(239, 68, 68, 0.1);
      border-left: 3px solid var(--color-critical);
      border-radius: var(--radius-sm);
    }

    .risk-title {
      color: var(--color-critical);
      font-weight: 600;
      font-size: var(--font-size-sm);
      margin-bottom: 4px;
    }

    .risk-text {
      color: var(--text-secondary);
      font-size: var(--font-size-sm);
      line-height: 1.5;
    }

    .summary-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: var(--gap-md);
      margin-bottom: var(--gap-xl);
    }

    .summary-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      padding: var(--gap-lg);
      text-align: center;
    }

    .summary-value {
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--text-primary);
      font-family: var(--font-mono);
    }

    .summary-label {
      font-size: var(--font-size-sm);
      color: var(--text-dim);
      margin-top: 4px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .filters {
      display: flex;
      gap: var(--gap-md);
      margin-bottom: var(--gap-xl);
      padding: var(--gap-lg);
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      flex-wrap: wrap;
      align-items: center;
    }

    .filter-group {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .filter-label {
      font-size: var(--font-size-sm);
      color: var(--text-dim);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .filter-btn {
      padding: 6px 12px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-color);
      border-radius: 20px;
      color: var(--text-secondary);
      font-size: var(--font-size-xs);
      cursor: pointer;
      transition: all var(--transition-fast);
      font-family: var(--font-mono);
    }

    .filter-btn:hover {
      background: var(--bg-primary);
      color: var(--text-primary);
    }

    .filter-btn.active {
      background: var(--color-info);
      color: white;
      border-color: var(--color-info);
    }

    .loading-state, .error-state {
      padding: var(--gap-xl);
      text-align: center;
      color: var(--text-dim);
    }

    .error-state {
      color: var(--color-critical);
    }
  </style>
</head>
<body>

  <header class="header">
    <div class="header-left">
      <svg width="28" height="28" viewBox="0 0 28 28" fill="none">
        <path d="M2 18 Q7 10 14 14 Q21 18 26 10" stroke="#3b82f6" stroke-width="2.5" stroke-linecap="round" fill="none"/>
        <path d="M2 14 Q7 6 14 10 Q21 14 26 6" stroke="#22c55e" stroke-width="2" stroke-linecap="round" fill="none" opacity="0.5"/>
      </svg>
      <h1 class="header-title">üß™ HYPOTHESES TRACKER</h1>
    </div>
    <div class="header-right">
      <div class="header-meta">
        <span class="header-meta-label">System:</span>
        <span>v1.0.0</span>
      </div>
      <div class="header-meta">
        <span class="header-meta-label">Updated:</span>
        <span>2026-02-05</span>
      </div>
    </div>
  </header>

  <nav class="nav-bar">
    <a href="../index.html">Mission Control</a>
    <a href="tup-navigator.html">üó∫Ô∏è TUP Navigator</a>
    <a href="hypotheses-tracker.html" class="active">üß™ Hypotheses Tracker</a>
    <a href="financial-forecast.html">üìä Financial Forecast</a>
    <a href="m0-trade-thesis.html">M0 Trade Thesis</a>
    <a href="m26-competitive-intel.html">M26 Competitive Intel</a>
    <a href="m27-customer-research.html">M27 Customer Research</a>
    <a href="customer-research.html">03 Customer Research</a>
  </nav>

  <div class="page-content">

    <div id="summary-stats" class="summary-grid">
      <div class="summary-card">
        <div class="summary-value">-</div>
        <div class="summary-label">Total Hypotheses</div>
      </div>
      <div class="summary-card">
        <div class="summary-value">-</div>
        <div class="summary-label">Critical Severity</div>
      </div>
      <div class="summary-card">
        <div class="summary-value">-</div>
        <div class="summary-label">Grade C or Lower</div>
      </div>
      <div class="summary-card">
        <div class="summary-value">-</div>
        <div class="summary-label">Validated</div>
      </div>
    </div>

    <div class="filters">
      <div class="filter-group">
        <span class="filter-label">Severity:</span>
        <button class="filter-btn active" data-filter="severity" data-value="all">All</button>
        <button class="filter-btn" data-filter="severity" data-value="CRITICAL">Critical</button>
        <button class="filter-btn" data-filter="severity" data-value="HIGH">High</button>
        <button class="filter-btn" data-filter="severity" data-value="MEDIUM">Medium</button>
      </div>
      <div class="filter-group">
        <span class="filter-label">Grade:</span>
        <button class="filter-btn active" data-filter="grade" data-value="all">All</button>
        <button class="filter-btn" data-filter="grade" data-value="A">A</button>
        <button class="filter-btn" data-filter="grade" data-value="B">B</button>
        <button class="filter-btn" data-filter="grade" data-value="C">C</button>
        <button class="filter-btn" data-filter="grade" data-value="D">D</button>
      </div>
      <div class="filter-group">
        <span class="filter-label">State:</span>
        <button class="filter-btn active" data-filter="state" data-value="all">All</button>
        <button class="filter-btn" data-filter="state" data-value="ASSUMED">Assumed</button>
        <button class="filter-btn" data-filter="state" data-value="TESTING">Testing</button>
        <button class="filter-btn" data-filter="state" data-value="VALIDATED">Validated</button>
      </div>
    </div>

    <div id="hypotheses-container" class="hypotheses-grid">
      <div class="loading-state">Loading hypotheses...</div>
    </div>

  </div>

  <footer class="footer">
    IonWave Hypotheses Tracker &middot; 8 Core Business Hypotheses &middot;
    <a href="https://github.com/caio-camargo/ionwave-dashboard/blob/main/IonWave/Hypothesis_Dependency_Audit.md" target="_blank">View Audit Report</a>
  </footer>

  <script>
    let hypothesesData = null;
    let filters = { severity: 'all', grade: 'all', state: 'all' };

    // Determine base path for data files
    function getBasePath() {
      const pathSegments = window.location.pathname.split('/').filter(s => s);
      // If we're on GitHub Pages (ionwave-dashboard in path), use absolute path
      const repoName = pathSegments.length > 0 && pathSegments[0] !== 'dashboard' && !pathSegments[0].endsWith('.html') ? pathSegments[0] : '';
      const base = repoName ? `/${repoName}` : '';
      return `${base}/data`;
    }

    async function loadHypotheses() {
      try {
        const basePath = getBasePath();
        console.log('Loading from base path:', basePath);

        const registryResponse = await fetch(`${basePath}/hypotheses/registry.json`);

        if (!registryResponse.ok) {
          throw new Error(`Failed to load registry: ${registryResponse.status} ${registryResponse.statusText}`);
        }

        hypothesesData = await registryResponse.json();
        console.log('Loaded hypotheses:', hypothesesData);

        updateSummaryStats();
        renderHypotheses();
      } catch (error) {
        console.error('Error loading hypotheses:', error);
        document.getElementById('hypotheses-container').innerHTML = `
          <div class="error-state">
            <p><strong>Failed to load hypotheses data</strong></p>
            <p>${error.message}</p>
            <p>Check console for details. Make sure .nojekyll file exists in repo root.</p>
          </div>
        `;
      }
    }

    function updateSummaryStats() {
      if (!hypothesesData) return;

      const hypotheses = hypothesesData.hypotheses;
      const criticalCount = hypotheses.filter(h => h.impact_severity === 'CRITICAL').length;
      const lowGradeCount = hypotheses.filter(h => ['C', 'D'].includes(h.current_grade)).length;
      const validatedCount = hypotheses.filter(h => h.current_state === 'VALIDATED').length;

      document.getElementById('summary-stats').innerHTML = `
        <div class="summary-card">
          <div class="summary-value">${hypotheses.length}</div>
          <div class="summary-label">Total Hypotheses</div>
        </div>
        <div class="summary-card">
          <div class="summary-value">${criticalCount}</div>
          <div class="summary-label">Critical Severity</div>
        </div>
        <div class="summary-card">
          <div class="summary-value">${lowGradeCount}</div>
          <div class="summary-label">Grade C or Lower</div>
        </div>
        <div class="summary-card">
          <div class="summary-value">${validatedCount}</div>
          <div class="summary-label">Validated</div>
        </div>
      `;
    }

    function renderHypotheses() {
      if (!hypothesesData) return;

      let hypotheses = hypothesesData.hypotheses;

      // Apply filters
      if (filters.severity !== 'all') {
        hypotheses = hypotheses.filter(h => h.impact_severity === filters.severity);
      }
      if (filters.grade !== 'all') {
        hypotheses = hypotheses.filter(h => h.current_grade === filters.grade);
      }
      if (filters.state !== 'all') {
        hypotheses = hypotheses.filter(h => h.current_state === filters.state);
      }

      const container = document.getElementById('hypotheses-container');

      if (hypotheses.length === 0) {
        container.innerHTML = '<div class="error-state">No hypotheses match the selected filters.</div>';
        return;
      }

      container.innerHTML = hypotheses.map(hyp => {
        const latestRevision = hyp.revisions[hyp.revisions.length - 1];
        const severityClass = hyp.impact_severity.toLowerCase();
        const gradeClass = `grade-${hyp.current_grade.toLowerCase()}`;

        // Handle risk_if_wrong which might be object or string
        let riskHtml = '';
        if (hyp.risk_if_wrong) {
          if (typeof hyp.risk_if_wrong === 'object') {
            riskHtml = `
              <div class="risk-box">
                <div class="risk-title">‚ö†Ô∏è Risk if Wrong ${hyp.risk_if_wrong.severity ? `(${hyp.risk_if_wrong.severity})` : ''}</div>
                <div class="risk-text">${hyp.risk_if_wrong.description || ''}</div>
                ${hyp.risk_if_wrong.financial_impact ? `<div class="risk-text" style="margin-top: 8px;"><strong>Impact:</strong> ${hyp.risk_if_wrong.financial_impact}</div>` : ''}
              </div>
            `;
          } else {
            riskHtml = `
              <div class="risk-box">
                <div class="risk-title">‚ö†Ô∏è Risk if Wrong</div>
                <div class="risk-text">${hyp.risk_if_wrong}</div>
              </div>
            `;
          }
        }

        return `
          <div class="hypothesis-card ${severityClass}">
            <div class="hyp-header">
              <div style="flex: 1;">
                <div class="hyp-id">${hyp.id}</div>
                <div class="hyp-name">
                  <a href="hypothesis-detail.html?id=${hyp.id}" style="color: inherit; text-decoration: none;">${hyp.name}</a>
                </div>
                <div class="hyp-badges">
                  <span class="badge badge-${hyp.current_state === 'ASSUMED' ? 'neutral' : hyp.current_state === 'VALIDATED' ? 'success' : 'warning'}">${hyp.current_state}</span>
                  <span class="badge badge-${severityClass === 'critical' ? 'critical' : severityClass === 'high' ? 'warning' : 'neutral'}">${hyp.impact_severity}</span>
                </div>
              </div>
              <div class="grade-badge ${gradeClass}">${hyp.current_grade}</div>
            </div>

            <div class="hyp-description">${hyp.description}</div>

            <div class="hyp-details">
              <div class="detail-item">
                <span class="detail-label">Category</span>
                <span class="detail-value">${hyp.category}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Current Value</span>
                <span class="detail-value">${latestRevision.value}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Revisions</span>
                <span class="detail-value">${hyp.revisions.length} version${hyp.revisions.length > 1 ? 's' : ''}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Last Updated</span>
                <span class="detail-value">${new Date(latestRevision.date).toLocaleDateString()}</span>
              </div>
            </div>

            ${riskHtml}

            <div style="margin-top: var(--gap-md); padding-top: var(--gap-md); border-top: 1px solid var(--border-color);">
              <a href="hypothesis-detail.html?id=${hyp.id}" class="btn-primary" style="display: inline-block; text-decoration: none; font-size: var(--font-size-sm);">View Full Details ‚Üí</a>
            </div>
          </div>
        `;
      }).join('');
    }

    // Filter button handlers
    document.querySelectorAll('.filter-btn').forEach(button => {
      button.addEventListener('click', () => {
        const filterType = button.dataset.filter;
        const value = button.dataset.value;

        // Update active state
        document.querySelectorAll(`[data-filter="${filterType}"]`).forEach(btn => {
          btn.classList.remove('active');
        });
        button.classList.add('active');

        // Update filters and re-render
        filters[filterType] = value;
        renderHypotheses();
      });
    });

    // Load on page load
    loadHypotheses();
  </script>

</body>
</html>
